{
  "model_version": "1.0",
  "steps": [
    {
      "index": 1,
      "title": "Introduction",
      "markdown": "<div class=\"alert\" style=\"background-color:#fff; color:white; padding:0px 10px; border-radius:5px;\"><h1 style='margin:15px 15px; color:#006a79; font-size:40px'>Predicting Rush Or Pass LightGBM Model</h1>\n</div>\n\n<div class=\"alert alert-info\" style=\"background-color:#006a79; color:white; padding:0px 10px; border-radius:5px;\"><h2 style='margin:10px 5px'>Setup Environment</h2>\n</div>\n\n<div class=\"alert alert-info\" style=\"background-color:#006a79; color:white; padding:0px 10px; border-radius:5px;\"><h2 style='margin:10px 5px'>Load Data</h2>\n</div>\n\n<div class=\"alert alert-info\" style=\"background-color:#006a79; color:white; padding:0px 10px; border-radius:5px;\"><h2 style='margin:10px 5px'>Preview Data</h2>\n</div>\n\n<div class=\"alert alert-info\" style=\"background-color:#006a79; color:white; padding:0px 10px; border-radius:5px;\"><h2 style='margin:10px 5px'>Data preprocessing (label creation + basic cleaning)</h2>\n</div>\n\n<div class=\"alert alert-info\" style=\"background-color:#006a79; color:white; padding:0px 10px; border-radius:5px;\"><h2 style='margin:10px 5px'>Model Building</h2>\n</div>\n\n<div class=\"alert alert-info\" style=\"background-color:#006a79; color:white; padding:0px 10px; border-radius:5px;\"><h2 style='margin:10px 5px'>Predictions and Performance Metric</h2>\n</div>\n\n#### `Summary` : \n\nOverall Accuracy\n\nAccuracy: ~66%\nThis means the model correctly predicted whether the next play was a pass or a rush 2 out of 3 times. Not bad for a first attempt with no engineered features.\n\n\u2696\ufe0f Class-by-Class Performance\n\nRush Plays (label = 0):\n\nPrecision: 0.60 (6 of 10 predicted rushes were correct)\n\nRecall: 0.58 (it only caught ~58% of actual rush plays)\n\nF1-score: 0.59\n\nPass Plays (label = 1):\n\nPrecision: 0.70 (7 of 10 predicted passes were correct)\n\nRecall: 0.72 (it caught ~72% of actual pass plays)\n\nF1-score: 0.71\n\n\ud83d\udc49 The model is currently better at predicting passes than rushes. It tends to miss rushes (predicting pass instead).",
      "blocks": [
        {
          "type": "code",
          "language": "python",
          "content": "#Import Libraries\nimport pandas as pd\nimport numpy as np\nimport nfl_data_py as nfl\n\npd.set_option('display.max_rows', 800)\npd.set_option('display.max_columns', 500)\n\nimport matplotlib.pyplot as plt\nimport matplotlib as mpl\nimport seaborn as sns\nsns.set()\n\nimport warnings\nwarnings.filterwarnings('ignore')\n\nfrom sklearn.model_selection import GroupShuffleSplit\nfrom sklearn.preprocessing import OrdinalEncoder\nfrom sklearn.metrics import accuracy_score, f1_score, confusion_matrix, classification_report\nimport lightgbm as lgb\n\nfrom sklearn.metrics import confusion_matrix \nfrom sklearn.metrics import classification_report \nfrom sklearn.metrics import accuracy_score \nfrom sklearn.metrics import RocCurveDisplay\nfrom sklearn.metrics import PrecisionRecallDisplay\nfrom sklearn.metrics import ConfusionMatrixDisplay\nfrom lightgbm import LGBMClassifier\nfrom lightgbm import early_stopping, log_evaluation"
        },
        {
          "type": "code",
          "language": "python",
          "content": "years = [2024]\nplay_by_play = nfl.import_pbp_data(years, downcast=True, cache=False)"
        },
        {
          "type": "stdout",
          "content": "2024 done.\nDowncasting floats.\n"
        },
        {
          "type": "code",
          "language": "python",
          "content": "play_by_play.info()"
        },
        {
          "type": "stdout",
          "content": "<class 'pandas.core.frame.DataFrame'>\nRangeIndex: 49492 entries, 0 to 49491\nColumns: 372 entries, play_id to pass_oe\ndtypes: float32(199), int32(7), int64(1), object(165)\nmemory usage: 101.6+ MB\n"
        },
        {
          "type": "code",
          "language": "python",
          "content": "play_by_play.describe()"
        },
        {
          "type": "stdout",
          "content": "            play_id          week  yardline_100  quarter_seconds_remaining  \\\ncount  49492.000000  49492.000000  45950.000000               49487.000000   \nmean    2194.845947      9.964701     47.231426                 409.086426   \nstd     1278.905273      5.584036     23.769236                 283.129852   \nmin        1.000000      1.000000      1.000000                   0.000000   \n25%     1094.000000      5.000000     30.000000                 143.000000   \n50%     2171.000000     10.000000     48.000000                 389.000000   \n75%     3278.000000     15.000000     67.000000                 654.000000   \nmax     5246.000000     22.000000     99.000000                 900.000000   \n\n       half_seconds_remaining  game_seconds_remaining   quarter_end  \\\ncount            49487.000000            49487.000000  49492.000000   \nmean               803.135315             1700.862183      0.017599   \nstd                561.692505             1056.346191      0.131489   \nmin                  0.000000                0.000000      0.000000   \n25%                271.000000              781.000000      0.000000   \n50%                782.000000             1800.000000      0.000000   \n75%               1286.000000             2578.000000      0.000000   \nmax               1800.000000             3600.000000      1.000000   \n\n              drive            sp           qtr          down    goal_to_go  \\\ncount  48929.000000  49492.000000  49492.000000  41483.000000  49492.000000   \nmean      11.296103      0.076113      2.569890      1.995830      0.052817   \nstd        6.554492      0.265182      1.126097      1.002988      0.223669   \nmin        1.000000      0.000000      1.000000      1.000000      0.000000   \n25%        6.000000      0.000000      2.000000      1.000000      0.000000   \n50%       11.000000      0.000000      3.000000      2.000000      0.000000   \n75%       17.000000      0.000000      4.000000      3.000000      0.000000   \nmax       31.000000      1.000000      5.000000      4.000000      1.000000   \n\n            ydstogo        ydsnet  yards_gained       shotgun    no_huddle  \\\ncount  49492.000000  48929.000000  47975.000000  49492.000000  49492.00000   \nmean       7.142104     41.254265      4.017259      0.538754      0.09747   \nstd        4.960590     28.218740      7.743334      0.498501      0.29660   \nmin        0.000000    -29.000000    -24.000000      0.000000      0.00000   \n25%        3.000000     15.000000      0.000000      0.000000      0.00000   \n50%        9.000000     43.000000      1.000000      1.000000      0.00000   \n75%       10.000000     68.000000      6.000000      1.000000      0.00000   \nmax       40.000000     99.000000     98.000000      1.000000      1.00000   \n\n        qb_dropback      qb_kneel      qb_spike   qb_scramble     air_yards  \\\ncount  48032.000000  49492.000000  49492.000000  49492.000000  18580.000000   \nmean       0.440102      0.008830      0.001596      0.024489      7.677825   \nstd        0.496404      0.093552      0.039921      0.154563     10.119400   \nmin        0.000000      0.000000      0.000000      0.000000    -17.000000   \n25%        0.000000      0.000000      0.000000      0.000000      1.000000   \n50%        0.000000      0.000000      0.000000      0.000000      5.000000   \n75%        1.000000      0.000000      0.000000      0.000000     12.000000   \nmax        1.000000      1.000000      1.000000      1.000000     61.000000   \n\n       yards_after_catch  kick_distance  home_timeouts_remaining  \\\ncount       12136.000000    7536.000000             49492.000000   \nmean            5.307597      49.834927                 2.573770   \nstd             6.898192      14.422908                 0.789902   \nmin           -11.000000       0.000000                 0.000000   \n25%             1.000000      33.000000                 2.000000   \n50%             3.000000      51.000000                 3.000000   \n75%             8.000000      65.000000                 3.000000   \nmax            78.000000      84.000000                 3.000000   \n\n       away_timeouts_remaining       timeout  posteam_timeouts_remaining  \\\ncount             49492.000000  47975.000000                46779.000000   \nmean                  2.543219      0.046149                    2.601937   \nstd                   0.801820      0.209810                    0.757403   \nmin                   0.000000      0.000000                    0.000000   \n25%                   2.000000      0.000000                    2.000000   \n50%                   3.000000      0.000000                    3.000000   \n75%                   3.000000      0.000000                    3.000000   \nmax                   3.000000      1.000000                    3.000000   \n\n       defteam_timeouts_remaining  total_home_score  total_away_score  \\\ncount                46779.000000      49492.000000      49492.000000   \nmean                     2.615533         11.966358         10.977208   \nstd                      0.736071         10.105292          9.472342   \nmin                      0.000000          0.000000          0.000000   \n25%                      2.000000          3.000000          3.000000   \n50%                      3.000000         10.000000         10.000000   \n75%                      3.000000         18.000000         17.000000   \nmax                      3.000000         55.000000         51.000000   \n\n       posteam_score  defteam_score  score_differential  posteam_score_post  \\\ncount   46779.000000   46779.000000        46779.000000        46779.000000   \nmean       10.626649      11.896770           -1.270121           10.898501   \nstd         9.524469       9.963309           10.375947            9.603809   \nmin         0.000000       0.000000          -46.000000            0.000000   \n25%         3.000000       3.000000           -7.000000            3.000000   \n50%         9.000000      10.000000            0.000000           10.000000   \n75%        17.000000      17.000000            4.000000           17.000000   \nmax        55.000000      55.000000           46.000000           55.000000   \n\n       defteam_score_post  score_differential_post  no_score_prob  \\\ncount        46779.000000             46779.000000   49492.000000   \nmean            11.905278                -1.006777       0.121842   \nstd              9.966299                10.467198       0.197430   \nmin              0.000000               -46.000000       0.000000   \n25%              3.000000                -7.000000       0.005190   \n50%             10.000000                 0.000000       0.025768   \n75%             17.000000                 5.000000       0.151825   \nmax             55.000000                46.000000       1.000000   \n\n        opp_fg_prob  opp_safety_prob   opp_td_prob       fg_prob  \\\ncount  49492.000000     49492.000000  49492.000000  49492.000000   \nmean       0.080644         0.001639      0.130544      0.239382   \nstd        0.062795         0.003663      0.106744      0.161629   \nmin        0.000000         0.000000      0.000000      0.000000   \n25%        0.020554         0.000412      0.028509      0.160050   \n50%        0.077834         0.001079      0.118969      0.216010   \n75%        0.128928         0.002051      0.216878      0.304063   \nmax        0.371882         0.138500      0.463006      0.997602   \n\n        safety_prob       td_prob  extra_point_prob  \\\ncount  49492.000000  49492.000000      49492.000000   \nmean       0.002337      0.321191          0.024659   \nstd        0.002019      0.185968          0.149723   \nmin        0.000000      0.000000          0.000000   \n25%        0.000797      0.217242          0.000000   \n50%        0.002170      0.353395          0.000000   \n75%        0.003481      0.432568          0.000000   \nmax        0.053067      0.930560          0.983250   \n\n       two_point_conversion_prob            ep           epa  total_home_epa  \\\ncount               49492.000000  48922.000000  48922.000000    49492.000000   \nmean                    0.001416      1.992105      0.012442        0.067516   \nstd                     0.025855      1.678757      1.260497       12.446965   \nmin                     0.000000     -3.272466    -12.689102      -52.601097   \n25%                     0.000000      0.883927     -0.554418       -6.995374   \n50%                     0.000000      1.745937     -0.000000        0.000000   \n75%                     0.000000      3.105580      0.531787        6.552356   \nmax                     0.473500      6.574304      8.541231       57.706867   \n\n       total_away_epa  total_home_rush_epa  total_away_rush_epa  \\\ncount    49492.000000         49492.000000         49492.000000   \nmean        -0.067516            -0.350601             0.350601   \nstd         12.446965             5.884502             5.884502   \nmin        -57.706867           -28.120405           -21.907663   \n25%         -6.552356            -3.585784            -2.974156   \n50%          0.000000            -0.317089             0.317089   \n75%          6.995374             2.974156             3.585784   \nmax         52.601097            21.907663            28.120405   \n\n       total_home_pass_epa  total_away_pass_epa       air_epa       yac_epa  \\\ncount         49492.000000         49492.000000  18505.000000  18505.000000   \nmean             -0.077810             0.077810      0.432828     -0.271108   \nstd              10.326223            10.326223      1.413761      1.936157   \nmin             -49.002647           -48.468239     -9.250458    -14.000000   \n25%              -5.768695            -5.482417     -0.620380     -0.612106   \n50%              -0.285420             0.285420      0.152442      0.037687   \n75%               5.482417             5.768695      1.350078      0.643027   \nmax              48.468239            49.002647      7.038276      8.218523   \n\n       comp_air_epa  comp_yac_epa  total_home_comp_air_epa  \\\ncount  47975.000000  47975.000000             49492.000000   \nmean       0.035764      0.170434                -0.284162   \nstd        0.631887      0.589104                 5.813495   \nmin       -9.250458     -8.098514               -22.633114   \n25%        0.000000      0.000000                -3.845936   \n50%        0.000000      0.000000                -0.113131   \n75%        0.000000      0.000000                 2.919821   \nmax        6.783885      8.218523                23.872591   \n\n       total_away_comp_air_epa  total_home_comp_yac_epa  \\\ncount             49492.000000             49492.000000   \nmean                  0.284162                 0.044787   \nstd                   5.813495                 6.232340   \nmin                 -23.872591               -22.693325   \n25%                  -2.919821                -3.573487   \n50%                   0.113131                 0.000000   \n75%                   3.845936                 3.487972   \nmax                  22.633114                29.372158   \n\n       total_away_comp_yac_epa  total_home_raw_air_epa  \\\ncount             49492.000000            49492.000000   \nmean                 -0.044787               -0.766269   \nstd                   6.232340                8.966341   \nmin                 -29.372158              -40.832268   \n25%                  -3.487972               -5.446473   \n50%                   0.000000               -0.453599   \n75%                   3.573487                4.160657   \nmax                  22.693325               33.606590   \n\n       total_away_raw_air_epa  total_home_raw_yac_epa  total_away_raw_yac_epa  \\\ncount            49492.000000            49492.000000            49492.000000   \nmean                 0.766269                0.565578               -0.565578   \nstd                  8.966341               12.113420               12.113420   \nmin                -33.606590              -60.836784              -61.069199   \n25%                 -4.160657               -6.044634               -7.026077   \n50%                  0.453599                0.073421               -0.073421   \n75%                  5.446473                7.026077                6.044634   \nmax                 40.832268               61.069199               60.836784   \n\n                 wp        def_wp       home_wp       away_wp           wpa  \\\ncount  49207.000000  49207.000000  49492.000000  49492.000000  48769.000000   \nmean       0.511415      0.488585      0.550598      0.449402      0.000983   \nstd        0.292883      0.292883      0.290337      0.290337      0.039643   \nmin        0.000036      0.000036      0.000000      0.000000     -0.665709   \n25%        0.286836      0.257341      0.341515      0.218250     -0.013696   \n50%        0.519887      0.480113      0.569187      0.430813      0.000000   \n75%        0.742659      0.713164      0.781750      0.658485      0.011198   \nmax        0.999964      0.999964      1.000000      1.000000      0.826717   \n\n          vegas_wpa  vegas_home_wpa  home_wp_post  away_wp_post      vegas_wp  \\\ncount  48769.000000    49207.000000  45987.000000  45987.000000  49207.000000   \nmean       0.001497        0.000026      0.551248      0.448752      0.510584   \nstd        0.037761        0.037704      0.289026      0.289026      0.315770   \nmin       -0.596922       -0.627027      0.000000      0.000000      0.000004   \n25%       -0.011158       -0.010602      0.343734      0.219638      0.238103   \n50%        0.000000        0.000000      0.572786      0.427214      0.514705   \n75%        0.009935        0.010465      0.780362      0.656265      0.789988   \nmax        0.902454        0.902454      1.000000      1.000000      0.999998   \n\n       vegas_home_wp  total_home_rush_wpa  total_away_rush_wpa  \\\ncount   49492.000000         49492.000000         49492.000000   \nmean        0.539124            -0.016207             0.016207   \nstd         0.314892             0.161536             0.161536   \nmin         0.000000            -0.844273            -0.750705   \n25%         0.270514            -0.107856            -0.076400   \n50%         0.567010            -0.011993             0.011993   \n75%         0.814419             0.076400             0.107856   \nmax         1.000000             0.750705             0.844273   \n\n       total_home_pass_wpa  total_away_pass_wpa       air_wpa       yac_wpa  \\\ncount         49492.000000         49492.000000  18505.000000  18505.000000   \nmean             -0.017501             0.017501      0.003488      0.000952   \nstd               0.248675             0.248675      0.041882      0.054889   \nmin              -1.101750            -1.041680     -0.976861     -0.948485   \n25%              -0.185086            -0.154556      0.000000     -0.015587   \n50%              -0.003128             0.003128      0.000000      0.000000   \n75%               0.154556             0.185086      0.000000      0.012751   \nmax               1.041680             1.101750      0.948512      1.000000   \n\n       comp_air_wpa  comp_yac_wpa  total_home_comp_air_wpa  \\\ncount  47975.000000  47975.000000             49492.000000   \nmean       0.001407      0.003936                -0.004575   \nstd        0.022331      0.026591                 0.165013   \nmin       -0.890454     -0.948485                -1.362129   \n25%        0.000000      0.000000                -0.062517   \n50%        0.000000      0.000000                 0.000000   \n75%        0.000000      0.000000                 0.038904   \nmax        0.948512      0.887658                 1.553818   \n\n       total_away_comp_air_wpa  total_home_comp_yac_wpa  \\\ncount             49492.000000             49492.000000   \nmean                  0.004575                -0.014303   \nstd                   0.165013                 0.236496   \nmin                  -1.553818                -1.908742   \n25%                  -0.038904                -0.126256   \n50%                   0.000000                -0.003221   \n75%                   0.062517                 0.102480   \nmax                   1.362129                 1.799456   \n\n       total_away_comp_yac_wpa  total_home_raw_air_wpa  \\\ncount             49492.000000            49492.000000   \nmean                  0.014303               -0.006408   \nstd                   0.236496                0.189220   \nmin                  -1.799456               -1.362586   \n25%                  -0.102480               -0.065477   \n50%                   0.003221                0.000000   \n75%                   0.126256                0.041594   \nmax                   1.908742                1.538134   \n\n       total_away_raw_air_wpa  total_home_raw_yac_wpa  total_away_raw_yac_wpa  \\\ncount            49492.000000            49492.000000            49492.000000   \nmean                 0.006408               -0.012748                0.012748   \nstd                  0.189220                0.292060                0.292060   \nmin                 -1.538134               -2.104285               -1.872535   \n25%                 -0.041594               -0.154775               -0.131862   \n50%                  0.000000                0.000000                0.000000   \n75%                  0.065477                0.131862                0.154775   \nmax                  1.362586                1.872535                2.104285   \n\n       punt_blocked  first_down_rush  first_down_pass  first_down_penalty  \\\ncount  47975.000000     47975.000000     47975.000000         47975.00000   \nmean       0.000250         0.080792         0.133174             0.02049   \nstd        0.015814         0.272518         0.339766             0.14167   \nmin        0.000000         0.000000         0.000000             0.00000   \n25%        0.000000         0.000000         0.000000             0.00000   \n50%        0.000000         0.000000         0.000000             0.00000   \n75%        0.000000         0.000000         0.000000             0.00000   \nmax        1.000000         1.000000         1.000000             1.00000   \n\n       third_down_converted  third_down_failed  fourth_down_converted  \\\ncount          47975.000000       47975.000000           47975.000000   \nmean               0.059698           0.090339               0.009713   \nstd                0.236928           0.286669               0.098078   \nmin                0.000000           0.000000               0.000000   \n25%                0.000000           0.000000               0.000000   \n50%                0.000000           0.000000               0.000000   \n75%                0.000000           0.000000               0.000000   \nmax                1.000000           1.000000               1.000000   \n\n       fourth_down_failed  incomplete_pass     touchback  interception  \\\ncount        47975.000000     47975.000000  49492.000000  47975.000000   \nmean             0.007316         0.125878      0.042350      0.008442   \nstd              0.085223         0.331715      0.201389      0.091492   \nmin              0.000000         0.000000      0.000000      0.000000   \n25%              0.000000         0.000000      0.000000      0.000000   \n50%              0.000000         0.000000      0.000000      0.000000   \n75%              0.000000         0.000000      0.000000      0.000000   \nmax              1.000000         1.000000      1.000000      1.000000   \n\n       punt_inside_twenty  punt_in_endzone  punt_out_of_bounds   punt_downed  \\\ncount         47975.00000     47975.000000        47975.000000  47975.000000   \nmean              0.01826         0.000063            0.004356      0.005315   \nstd               0.13389         0.007908            0.065860      0.072713   \nmin               0.00000         0.000000            0.000000      0.000000   \n25%               0.00000         0.000000            0.000000      0.000000   \n50%               0.00000         0.000000            0.000000      0.000000   \n75%               0.00000         0.000000            0.000000      0.000000   \nmax               1.00000         1.000000            1.000000      1.000000   \n\n       punt_fair_catch  kickoff_inside_twenty  kickoff_in_endzone  \\\ncount     47975.000000           47975.000000        47975.000000   \nmean          0.012027               0.001084            0.007858   \nstd           0.109008               0.032905            0.088299   \nmin           0.000000               0.000000            0.000000   \n25%           0.000000               0.000000            0.000000   \n50%           0.000000               0.000000            0.000000   \n75%           0.000000               0.000000            0.000000   \nmax           1.000000               1.000000            1.000000   \n\n       kickoff_out_of_bounds  kickoff_downed  kickoff_fair_catch  \\\ncount           47975.000000         47975.0        47975.000000   \nmean                0.000396             0.0            0.000063   \nstd                 0.019897             0.0            0.007908   \nmin                 0.000000             0.0            0.000000   \n25%                 0.000000             0.0            0.000000   \n50%                 0.000000             0.0            0.000000   \n75%                 0.000000             0.0            0.000000   \nmax                 1.000000             0.0            1.000000   \n\n       fumble_forced  fumble_not_forced  fumble_out_of_bounds   solo_tackle  \\\ncount   47975.000000       47975.000000          47975.000000  47975.000000   \nmean        0.009422           0.004440              0.001188      0.420511   \nstd         0.096607           0.066485              0.034449      0.493646   \nmin         0.000000           0.000000              0.000000      0.000000   \n25%         0.000000           0.000000              0.000000      0.000000   \n50%         0.000000           0.000000              0.000000      0.000000   \n75%         0.000000           0.000000              0.000000      1.000000   \nmax         1.000000           1.000000              1.000000      1.000000   \n\n             safety       penalty  tackled_for_loss   fumble_lost  \\\ncount  47975.000000  47975.000000      47975.000000  47975.000000   \nmean       0.000354      0.075915          0.027556      0.005941   \nstd        0.018821      0.264864          0.163699      0.076847   \nmin        0.000000      0.000000          0.000000      0.000000   \n25%        0.000000      0.000000          0.000000      0.000000   \n50%        0.000000      0.000000          0.000000      0.000000   \n75%        0.000000      0.000000          0.000000      0.000000   \nmax        1.000000      1.000000          1.000000      1.000000   \n\n       own_kickoff_recovery  own_kickoff_recovery_td        qb_hit  \\\ncount          47975.000000                  47975.0  47975.000000   \nmean               0.000063                      0.0      0.062616   \nstd                0.007908                      0.0      0.242273   \nmin                0.000000                      0.0      0.000000   \n25%                0.000000                      0.0      0.000000   \n50%                0.000000                      0.0      0.000000   \n75%                0.000000                      0.0      0.000000   \nmax                1.000000                      0.0      1.000000   \n\n       rush_attempt  pass_attempt          sack     touchdown  pass_touchdown  \\\ncount  47975.000000  47975.000000  47975.000000  47975.000000    47975.000000   \nmean       0.322689      0.418593      0.029015      0.030453        0.017613   \nstd        0.467510      0.493334      0.167851      0.171833        0.131543   \nmin        0.000000      0.000000      0.000000      0.000000        0.000000   \n25%        0.000000      0.000000      0.000000      0.000000        0.000000   \n50%        0.000000      0.000000      0.000000      0.000000        0.000000   \n75%        1.000000      1.000000      0.000000      0.000000        0.000000   \nmax        1.000000      1.000000      1.000000      1.000000        1.000000   \n\n       rush_touchdown  return_touchdown  extra_point_attempt  \\\ncount    47975.000000      47975.000000         47975.000000   \nmean         0.011360          0.001292             0.027139   \nstd          0.105978          0.035926             0.162490   \nmin          0.000000          0.000000             0.000000   \n25%          0.000000          0.000000             0.000000   \n50%          0.000000          0.000000             0.000000   \n75%          0.000000          0.000000             0.000000   \nmax          1.000000          1.000000             1.000000   \n\n       two_point_attempt  field_goal_attempt  kickoff_attempt  punt_attempt  \\\ncount       47975.000000        47975.000000     47980.000000  47975.000000   \nmean            0.003085            0.024304         0.061609      0.044169   \nstd             0.055457            0.153994         0.240447      0.205472   \nmin             0.000000            0.000000         0.000000      0.000000   \n25%             0.000000            0.000000         0.000000      0.000000   \n50%             0.000000            0.000000         0.000000      0.000000   \n75%             0.000000            0.000000         0.000000      0.000000   \nmax             1.000000            1.000000         1.000000      1.000000   \n\n             fumble  complete_pass  assist_tackle  lateral_reception  \\\ncount  47975.000000   47975.000000   47975.000000       47975.000000   \nmean       0.013820       0.252965       0.181428           0.000417   \nstd        0.116743       0.434716       0.385376           0.020414   \nmin        0.000000       0.000000       0.000000           0.000000   \n25%        0.000000       0.000000       0.000000           0.000000   \n50%        0.000000       0.000000       0.000000           0.000000   \n75%        0.000000       1.000000       0.000000           0.000000   \nmax        1.000000       1.000000       1.000000           1.000000   \n\n       lateral_rush  lateral_return  lateral_recovery  passing_yards  \\\ncount  47975.000000    47975.000000      47975.000000   12136.000000   \nmean       0.000063        0.000083          0.001980      10.963085   \nstd        0.007908        0.009131          0.044456       9.859204   \nmin        0.000000        0.000000          0.000000     -24.000000   \n25%        0.000000        0.000000          0.000000       5.000000   \n50%        0.000000        0.000000          0.000000       8.000000   \n75%        0.000000        0.000000          0.000000      14.000000   \nmax        1.000000        1.000000          1.000000      98.000000   \n\n       receiving_yards  rushing_yards  lateral_receiving_yards  \\\ncount     12136.000000   15443.000000                20.000000   \nmean         10.948995       4.451208                 7.850000   \nstd           9.844776       6.367933                14.269124   \nmin         -11.000000     -18.000000               -23.000000   \n25%           5.000000       1.000000                 0.250000   \n50%           8.000000       3.000000                 8.000000   \n75%          14.000000       6.000000                15.250000   \nmax          98.000000      92.000000                41.000000   \n\n       lateral_rushing_yards  tackle_with_assist  fumble_recovery_1_yards  \\\ncount               3.000000        47975.000000               608.000000   \nmean                6.333333            0.053611                 2.120066   \nstd                 6.110101            0.225251                 9.126083   \nmin                 1.000000            0.000000                -7.000000   \n25%                 3.000000            0.000000                 0.000000   \n50%                 5.000000            0.000000                 0.000000   \n75%                 9.000000            0.000000                 0.000000   \nmax                13.000000            1.000000               102.000000   \n\n       fumble_recovery_2_yards  return_yards  penalty_yards  \\\ncount                 3.000000  47975.000000    3642.000000   \nmean                  9.666667      0.843189       8.091434   \nstd                  15.885003      4.933508       5.156825   \nmin                   0.000000     -5.000000       0.000000   \n25%                   0.500000      0.000000       5.000000   \n50%                   1.000000      0.000000       5.000000   \n75%                  14.500000      0.000000      10.000000   \nmax                  28.000000    103.000000      48.000000   \n\n       replay_or_challenge  defensive_two_point_attempt  \\\ncount         49492.000000                 47975.000000   \nmean              0.006991                     0.000146   \nstd               0.083320                     0.012079   \nmin               0.000000                     0.000000   \n25%               0.000000                     0.000000   \n50%               0.000000                     0.000000   \n75%               0.000000                     0.000000   \nmax               1.000000                     1.000000   \n\n       defensive_two_point_conv  defensive_extra_point_attempt  \\\ncount              47975.000000                        47975.0   \nmean                   0.000042                            0.0   \nstd                    0.006457                            0.0   \nmin                    0.000000                            0.0   \n25%                    0.000000                            0.0   \n50%                    0.000000                            0.0   \n75%                    0.000000                            0.0   \nmax                    1.000000                            0.0   \n\n       defensive_extra_point_conv   season            cp          cpoe  \\\ncount                     47975.0  49492.0  17748.000000  17748.000000   \nmean                          0.0   2024.0      0.674038      0.975722   \nstd                           0.0      0.0      0.172654     43.152374   \nmin                           0.0   2024.0      0.153086    -92.344002   \n25%                           0.0   2024.0      0.566356    -38.263340   \n50%                           0.0   2024.0      0.728102     18.431664   \n75%                           0.0   2024.0      0.803837     28.399195   \nmax                           0.0   2024.0      0.923440     80.109200   \n\n             series  series_success  order_sequence  play_deleted  \\\ncount  49492.000000    49492.000000    49492.000000       49492.0   \nmean      28.663116        0.586883     2193.616211           0.0   \nstd       16.603432        0.492399     1278.287598           0.0   \nmin        1.000000        0.000000        1.000000           0.0   \n25%       14.000000        0.000000     1094.000000           0.0   \n50%       28.000000        1.000000     2168.500000           0.0   \n75%       43.000000        1.000000     3278.000000           0.0   \nmax       71.000000        1.000000     5246.000000           0.0   \n\n       special_teams_play   fixed_drive  drive_play_count  drive_first_downs  \\\ncount        49492.000000  49492.000000      48929.000000       48929.000000   \nmean             0.128950     11.235715          7.632059           2.587934   \nstd              0.335148      6.574415          3.664601           1.898299   \nmin              0.000000      1.000000          0.000000           0.000000   \n25%              0.000000      6.000000          5.000000           1.000000   \n50%              0.000000     11.000000          7.000000           2.000000   \n75%              0.000000     16.000000         10.000000           4.000000   \nmax              1.000000     31.000000         21.000000           9.000000   \n\n       drive_inside20  drive_ended_with_score  drive_quarter_start  \\\ncount    48929.000000            48929.000000         48929.000000   \nmean         0.435856                0.517873             2.518772   \nstd          0.495874                0.499686             1.126602   \nmin          0.000000                0.000000             1.000000   \n25%          0.000000                0.000000             2.000000   \n50%          0.000000                1.000000             3.000000   \n75%          1.000000                1.000000             4.000000   \nmax          1.000000                1.000000             5.000000   \n\n       drive_quarter_end  drive_yards_penalized  drive_play_id_started  \\\ncount       48929.000000           48929.000000           48929.000000   \nmean            2.645241              -0.263361            2088.518555   \nstd             1.118492               7.958590            1268.998413   \nmin             1.000000             -45.000000              38.000000   \n25%             2.000000              -4.000000             995.000000   \n50%             3.000000               0.000000            2092.000000   \n75%             4.000000               0.000000            3159.000000   \nmax             5.000000              61.000000            5144.000000   \n\n       drive_play_id_ended    away_score    home_score        result  \\\ncount         48929.000000  49492.000000  49492.000000  49492.000000   \nmean           2314.772461     22.123919     24.275075      2.151156   \nstd            1268.592529      9.375718     10.116238     14.263106   \nmin              39.000000      0.000000      2.000000    -38.000000   \n25%            1234.000000     15.000000     18.000000     -6.000000   \n50%            2280.000000     21.000000     24.000000      2.000000   \n75%            3390.000000     28.000000     31.000000      9.000000   \nmax            5220.000000     51.000000     55.000000     46.000000   \n\n              total   spread_line    total_line      div_game          temp  \\\ncount  49492.000000  49492.000000  49492.000000  49492.000000  31477.000000   \nmean      46.398994      1.569446     44.503506      0.347309     58.665470   \nstd       13.305958      5.525987      4.068257      0.476120     17.634039   \nmin        9.000000    -16.500000     32.500000      0.000000     14.000000   \n25%       37.000000     -3.000000     41.500000      0.000000     48.000000   \n50%       46.000000      2.500000     44.500000      0.000000     59.000000   \n75%       54.000000      6.000000     47.500000      1.000000     73.000000   \nmax       90.000000     19.500000     56.500000      1.000000     93.000000   \n\n               wind  aborted_play       success  passer_jersey_number  \\\ncount  31477.000000  49492.000000  48922.000000          22428.000000   \nmean       7.989230      0.002324      0.451392              9.601347   \nstd        4.027314      0.048148      0.497637              5.089272   \nmin        0.000000      0.000000      0.000000              1.000000   \n25%        5.000000      0.000000      0.000000              6.000000   \n50%        8.000000      0.000000      0.000000              9.000000   \n75%       10.000000      0.000000      1.000000             14.000000   \nmax       20.000000      1.000000      1.000000             84.000000   \n\n       rusher_jersey_number  receiver_jersey_number          pass  \\\ncount          15493.000000            19008.000000  49492.000000   \nmean              19.825663               32.751419      0.453184   \nstd               12.744450               33.039612      0.497808   \nmin                0.000000                0.000000      0.000000   \n25%                8.000000                9.000000      0.000000   \n50%               22.000000               17.000000      0.000000   \n75%               28.000000               81.000000      1.000000   \nmax               89.000000               94.000000      1.000000   \n\n               rush    first_down       special          play  jersey_number  \\\ncount  49492.000000  47975.000000  49492.000000  49492.000000   36707.000000   \nmean       0.288855      0.232371      0.152267      0.764911      13.931458   \nstd        0.453235      0.422349      0.359283      0.424058      10.433880   \nmin        0.000000      0.000000      0.000000      0.000000       0.000000   \n25%        0.000000      0.000000      0.000000      1.000000       7.000000   \n50%        0.000000      0.000000      0.000000      1.000000      10.000000   \n75%        1.000000      0.000000      0.000000      1.000000      20.000000   \nmax        1.000000      1.000000      1.000000      1.000000      89.000000   \n\n       out_of_bounds  home_opening_kickoff        qb_epa      xyac_epa  \\\ncount   49492.000000          49492.000000  48922.000000  16511.000000   \nmean        0.084943              0.507819      0.018444      0.730060   \nstd         0.278800              0.499944      1.250831      0.516497   \nmin         0.000000              0.000000    -12.689102     -1.555835   \n25%         0.000000              0.000000     -0.552899      0.327920   \n50%         0.000000              1.000000     -0.000000      0.605034   \n75%         0.000000              1.000000      0.534317      1.008609   \nmax         1.000000              1.000000      8.541231      9.585749   \n\n       xyac_mean_yardage  xyac_median_yardage  xyac_success       xyac_fd  \\\ncount       16511.000000         16511.000000  16511.000000  16511.000000   \nmean            5.542846             3.724971      0.773309      0.574204   \nstd             2.544188             2.612787      0.254200      0.357722   \nmin             0.497469             0.000000      0.026981      0.004220   \n25%             3.784112             2.000000      0.551024      0.241776   \n50%             4.650056             3.000000      0.981908      0.465574   \n75%             6.934323             5.000000      1.000000      0.999322   \nmax            23.952005            36.000000      1.000000      1.000000   \n\n              xpass       pass_oe  \ncount  37672.000000  36570.000000  \nmean       0.628901     -1.752240  \nstd        0.241009     42.327759  \nmin        0.017579    -99.435692  \n25%        0.455769    -42.689049  \n50%        0.604551      3.783369  \n75%        0.858460     32.116222  \nmax        0.997794     97.784882  "
        },
        {
          "type": "code",
          "language": "python",
          "content": "play_by_play.head()"
        },
        {
          "type": "stdout",
          "content": "   play_id          game_id old_game_id home_team away_team season_type  week  \\\n0      1.0  2024_01_ARI_BUF  2024090801       BUF       ARI         REG     1   \n1     40.0  2024_01_ARI_BUF  2024090801       BUF       ARI         REG     1   \n2     61.0  2024_01_ARI_BUF  2024090801       BUF       ARI         REG     1   \n3     83.0  2024_01_ARI_BUF  2024090801       BUF       ARI         REG     1   \n4    108.0  2024_01_ARI_BUF  2024090801       BUF       ARI         REG     1   \n\n  posteam posteam_type defteam side_of_field  yardline_100   game_date  \\\n0    None         None    None          None           NaN  2024-09-08   \n1     ARI         away     BUF           BUF          35.0  2024-09-08   \n2     ARI         away     BUF           ARI          70.0  2024-09-08   \n3     ARI         away     BUF           ARI          67.0  2024-09-08   \n4     ARI         away     BUF           BUF          45.0  2024-09-08   \n\n   quarter_seconds_remaining  half_seconds_remaining  game_seconds_remaining  \\\n0                      900.0                  1800.0                  3600.0   \n1                      900.0                  1800.0                  3600.0   \n2                      900.0                  1800.0                  3600.0   \n3                      867.0                  1767.0                  3567.0   \n4                      823.0                  1723.0                  3523.0   \n\n  game_half  quarter_end  drive   sp  qtr  down  goal_to_go   time   yrdln  \\\n0     Half1          0.0    NaN  0.0  1.0   NaN           0  15:00  BUF 35   \n1     Half1          0.0    1.0  0.0  1.0   NaN           0  15:00  BUF 35   \n2     Half1          0.0    1.0  0.0  1.0   1.0           0  15:00  ARI 30   \n3     Half1          0.0    1.0  0.0  1.0   2.0           0  14:27  ARI 33   \n4     Half1          0.0    1.0  0.0  1.0   1.0           0  13:43  BUF 45   \n\n   ydstogo  ydsnet                                               desc  \\\n0      0.0     NaN                                               GAME   \n1      0.0    70.0  2-T.Bass kicks 65 yards from BUF 35 to end zon...   \n2     10.0    70.0  (15:00) 6-J.Conner up the middle to ARI 33 for...   \n3      7.0    70.0  (14:27) 1-K.Murray pass short left to 6-J.Conn...   \n4     10.0    70.0  (13:43) (Shotgun) 1-K.Murray pass short middle...   \n\n  play_type  yards_gained  shotgun  no_huddle  qb_dropback  qb_kneel  \\\n0      None           NaN      0.0        0.0          NaN       0.0   \n1   kickoff           0.0      0.0        0.0          0.0       0.0   \n2       run           3.0      0.0        0.0          0.0       0.0   \n3      pass          22.0      0.0        0.0          1.0       0.0   \n4      pass           9.0      1.0        0.0          1.0       0.0   \n\n   qb_spike  qb_scramble pass_length pass_location  air_yards  \\\n0       0.0          0.0        None          None        NaN   \n1       0.0          0.0        None          None        NaN   \n2       0.0          0.0        None          None        NaN   \n3       0.0          0.0       short          left       -3.0   \n4       0.0          0.0       short        middle        2.0   \n\n   yards_after_catch run_location run_gap field_goal_result  kick_distance  \\\n0                NaN         None    None              None            NaN   \n1                NaN         None    None              None           65.0   \n2                NaN       middle    None              None            NaN   \n3               25.0         None    None              None            NaN   \n4                7.0         None    None              None            NaN   \n\n  extra_point_result two_point_conv_result  home_timeouts_remaining  \\\n0               None                  None                      3.0   \n1               None                  None                      3.0   \n2               None                  None                      3.0   \n3               None                  None                      3.0   \n4               None                  None                      3.0   \n\n   away_timeouts_remaining  timeout timeout_team td_team td_player_name  \\\n0                      3.0      NaN         None    None           None   \n1                      3.0      0.0         None    None           None   \n2                      3.0      0.0         None    None           None   \n3                      3.0      0.0         None    None           None   \n4                      3.0      0.0         None    None           None   \n\n  td_player_id  posteam_timeouts_remaining  defteam_timeouts_remaining  \\\n0         None                         NaN                         NaN   \n1         None                         3.0                         3.0   \n2         None                         3.0                         3.0   \n3         None                         3.0                         3.0   \n4         None                         3.0                         3.0   \n\n   total_home_score  total_away_score  posteam_score  defteam_score  \\\n0               0.0               0.0            NaN            NaN   \n1               0.0               0.0            0.0            0.0   \n2               0.0               0.0            0.0            0.0   \n3               0.0               0.0            0.0            0.0   \n4               0.0               0.0            0.0            0.0   \n\n   score_differential  posteam_score_post  defteam_score_post  \\\n0                 NaN                 NaN                 NaN   \n1                 0.0                 0.0                 0.0   \n2                 0.0                 0.0                 0.0   \n3                 0.0                 0.0                 0.0   \n4                 0.0                 0.0                 0.0   \n\n   score_differential_post  no_score_prob  opp_fg_prob  opp_safety_prob  \\\n0                      NaN       0.000000     0.000000         0.000000   \n1                      0.0       0.004568     0.143585         0.002325   \n2                      0.0       0.004585     0.140649         0.003159   \n3                      0.0       0.004817     0.142571         0.002405   \n4                      0.0       0.004927     0.080094         0.001128   \n\n   opp_td_prob   fg_prob  safety_prob   td_prob  extra_point_prob  \\\n0     0.000000  0.000000     0.000000  0.000000               0.0   \n1     0.275986  0.215226     0.003265  0.355046               0.0   \n2     0.260660  0.209893     0.003228  0.377827               0.0   \n3     0.270632  0.220688     0.003977  0.354910               0.0   \n4     0.144228  0.314572     0.004124  0.450927               0.0   \n\n   two_point_conversion_prob        ep       epa  total_home_epa  \\\n0                        0.0  0.770222 -0.000000        0.000000   \n1                        0.0  0.770222  0.257819       -0.257819   \n2                        0.0  1.028041 -0.200602       -0.057217   \n3                        0.0  0.827439  2.028874       -2.086091   \n4                        0.0  2.856313  0.754242       -2.840333   \n\n   total_away_epa  total_home_rush_epa  total_away_rush_epa  \\\n0        0.000000             0.000000             0.000000   \n1        0.257819             0.000000             0.000000   \n2        0.057217             0.200602            -0.200602   \n3        2.086091             0.200602            -0.200602   \n4        2.840333             0.200602            -0.200602   \n\n   total_home_pass_epa  total_away_pass_epa   air_epa   yac_epa  comp_air_epa  \\\n0             0.000000             0.000000       NaN       NaN           NaN   \n1             0.000000             0.000000       NaN       NaN      0.000000   \n2             0.000000             0.000000       NaN       NaN      0.000000   \n3            -2.028874             2.028874 -1.083852  3.112726     -1.083852   \n4            -2.783116             2.783116 -0.567367  1.321609     -0.567367   \n\n   comp_yac_epa  total_home_comp_air_epa  total_away_comp_air_epa  \\\n0           NaN                 0.000000                 0.000000   \n1      0.000000                 0.000000                 0.000000   \n2      0.000000                 0.000000                 0.000000   \n3      3.112726                 1.083852                -1.083852   \n4      1.321609                 1.651219                -1.651219   \n\n   total_home_comp_yac_epa  total_away_comp_yac_epa  total_home_raw_air_epa  \\\n0                 0.000000                 0.000000                0.000000   \n1                 0.000000                 0.000000                0.000000   \n2                 0.000000                 0.000000                0.000000   \n3                -3.112726                 3.112726                1.083852   \n4                -4.434335                 4.434335                1.651219   \n\n   total_away_raw_air_epa  total_home_raw_yac_epa  total_away_raw_yac_epa  \\\n0                0.000000                0.000000                0.000000   \n1                0.000000                0.000000                0.000000   \n2                0.000000                0.000000                0.000000   \n3               -1.083852               -3.112726                3.112726   \n4               -1.651219               -4.434335                4.434335   \n\n         wp    def_wp   home_wp   away_wp       wpa  vegas_wpa  \\\n0  0.433208  0.566792  0.566792  0.433208 -0.000000  -0.000000   \n1  0.433208  0.566792  0.566792  0.433208  0.000338   0.003076   \n2  0.433546  0.566454  0.566454  0.433546 -0.007270  -0.003599   \n3  0.426276  0.573724  0.573724  0.426276  0.053842   0.051482   \n4  0.480118  0.519882  0.519882  0.480118  0.054495   0.018542   \n\n   vegas_home_wpa  home_wp_post  away_wp_post  vegas_wp  vegas_home_wp  \\\n0        0.000000           NaN           NaN  0.250386       0.749614   \n1       -0.003076      0.566454      0.433546  0.250386       0.749614   \n2        0.003599      0.573724      0.426276  0.253462       0.746538   \n3       -0.051482      0.519882      0.480118  0.249864       0.750136   \n4       -0.018542      0.465387      0.534613  0.301346       0.698654   \n\n   total_home_rush_wpa  total_away_rush_wpa  total_home_pass_wpa  \\\n0              0.00000              0.00000             0.000000   \n1              0.00000              0.00000             0.000000   \n2              0.00727             -0.00727             0.000000   \n3              0.00727             -0.00727            -0.053842   \n4              0.00727             -0.00727            -0.108337   \n\n   total_away_pass_wpa  air_wpa   yac_wpa  comp_air_wpa  comp_yac_wpa  \\\n0             0.000000      NaN       NaN           NaN           NaN   \n1             0.000000      NaN       NaN           0.0      0.000000   \n2             0.000000      NaN       NaN           0.0      0.000000   \n3             0.053842      0.0  0.053842           0.0      0.053842   \n4             0.108337      0.0  0.054495           0.0      0.054495   \n\n   total_home_comp_air_wpa  total_away_comp_air_wpa  total_home_comp_yac_wpa  \\\n0                      0.0                      0.0                 0.000000   \n1                      0.0                      0.0                 0.000000   \n2                      0.0                      0.0                 0.000000   \n3                      0.0                      0.0                -0.053842   \n4                      0.0                      0.0                -0.108337   \n\n   total_away_comp_yac_wpa  total_home_raw_air_wpa  total_away_raw_air_wpa  \\\n0                 0.000000                     0.0                     0.0   \n1                 0.000000                     0.0                     0.0   \n2                 0.000000                     0.0                     0.0   \n3                 0.053842                     0.0                     0.0   \n4                 0.108337                     0.0                     0.0   \n\n   total_home_raw_yac_wpa  total_away_raw_yac_wpa  punt_blocked  \\\n0                0.000000                0.000000           NaN   \n1                0.000000                0.000000           0.0   \n2                0.000000                0.000000           0.0   \n3               -0.053842                0.053842           0.0   \n4               -0.108337                0.108337           0.0   \n\n   first_down_rush  first_down_pass  first_down_penalty  third_down_converted  \\\n0              NaN              NaN                 NaN                   NaN   \n1              0.0              0.0                 0.0                   0.0   \n2              0.0              0.0                 0.0                   0.0   \n3              0.0              1.0                 0.0                   0.0   \n4              0.0              0.0                 0.0                   0.0   \n\n   third_down_failed  fourth_down_converted  fourth_down_failed  \\\n0                NaN                    NaN                 NaN   \n1                0.0                    0.0                 0.0   \n2                0.0                    0.0                 0.0   \n3                0.0                    0.0                 0.0   \n4                0.0                    0.0                 0.0   \n\n   incomplete_pass  touchback  interception  punt_inside_twenty  \\\n0              NaN        0.0           NaN                 NaN   \n1              0.0        1.0           0.0                 0.0   \n2              0.0        0.0           0.0                 0.0   \n3              0.0        0.0           0.0                 0.0   \n4              0.0        0.0           0.0                 0.0   \n\n   punt_in_endzone  punt_out_of_bounds  punt_downed  punt_fair_catch  \\\n0              NaN                 NaN          NaN              NaN   \n1              0.0                 0.0          0.0              0.0   \n2              0.0                 0.0          0.0              0.0   \n3              0.0                 0.0          0.0              0.0   \n4              0.0                 0.0          0.0              0.0   \n\n   kickoff_inside_twenty  kickoff_in_endzone  kickoff_out_of_bounds  \\\n0                    NaN                 NaN                    NaN   \n1                    0.0                 0.0                    0.0   \n2                    0.0                 0.0                    0.0   \n3                    0.0                 0.0                    0.0   \n4                    0.0                 0.0                    0.0   \n\n   kickoff_downed  kickoff_fair_catch  fumble_forced  fumble_not_forced  \\\n0             NaN                 NaN            NaN                NaN   \n1             0.0                 0.0            0.0                0.0   \n2             0.0                 0.0            0.0                0.0   \n3             0.0                 0.0            0.0                0.0   \n4             0.0                 0.0            0.0                0.0   \n\n   fumble_out_of_bounds  solo_tackle  safety  penalty  tackled_for_loss  \\\n0                   NaN          NaN     NaN      NaN               NaN   \n1                   0.0          0.0     0.0      0.0               0.0   \n2                   0.0          0.0     0.0      0.0               0.0   \n3                   0.0          0.0     0.0      0.0               0.0   \n4                   0.0          0.0     0.0      0.0               0.0   \n\n   fumble_lost  own_kickoff_recovery  own_kickoff_recovery_td  qb_hit  \\\n0          NaN                   NaN                      NaN     NaN   \n1          0.0                   0.0                      0.0     0.0   \n2          0.0                   0.0                      0.0     0.0   \n3          0.0                   0.0                      0.0     0.0   \n4          0.0                   0.0                      0.0     0.0   \n\n   rush_attempt  pass_attempt  sack  touchdown  pass_touchdown  \\\n0           NaN           NaN   NaN        NaN             NaN   \n1           0.0           0.0   0.0        0.0             0.0   \n2           1.0           0.0   0.0        0.0             0.0   \n3           0.0           1.0   0.0        0.0             0.0   \n4           0.0           1.0   0.0        0.0             0.0   \n\n   rush_touchdown  return_touchdown  extra_point_attempt  two_point_attempt  \\\n0             NaN               NaN                  NaN                NaN   \n1             0.0               0.0                  0.0                0.0   \n2             0.0               0.0                  0.0                0.0   \n3             0.0               0.0                  0.0                0.0   \n4             0.0               0.0                  0.0                0.0   \n\n   field_goal_attempt  kickoff_attempt  punt_attempt  fumble  complete_pass  \\\n0                 NaN              NaN           NaN     NaN            NaN   \n1                 0.0              1.0           0.0     0.0            0.0   \n2                 0.0              0.0           0.0     0.0            0.0   \n3                 0.0              0.0           0.0     0.0            1.0   \n4                 0.0              0.0           0.0     0.0            1.0   \n\n   assist_tackle  lateral_reception  lateral_rush  lateral_return  \\\n0            NaN                NaN           NaN             NaN   \n1            0.0                0.0           0.0             0.0   \n2            1.0                0.0           0.0             0.0   \n3            1.0                0.0           0.0             0.0   \n4            1.0                0.0           0.0             0.0   \n\n   lateral_recovery passer_player_id passer_player_name  passing_yards  \\\n0               NaN             None               None            NaN   \n1               0.0             None               None            NaN   \n2               0.0             None               None            NaN   \n3               0.0       00-0035228           K.Murray           22.0   \n4               0.0       00-0035228           K.Murray            9.0   \n\n  receiver_player_id receiver_player_name  receiving_yards rusher_player_id  \\\n0               None                 None              NaN             None   \n1               None                 None              NaN             None   \n2               None                 None              NaN       00-0033553   \n3         00-0033553             J.Conner             22.0             None   \n4         00-0033553             J.Conner              9.0             None   \n\n  rusher_player_name  rushing_yards lateral_receiver_player_id  \\\n0               None            NaN                       None   \n1               None            NaN                       None   \n2           J.Conner            3.0                       None   \n3               None            NaN                       None   \n4               None            NaN                       None   \n\n  lateral_receiver_player_name  lateral_receiving_yards  \\\n0                         None                      NaN   \n1                         None                      NaN   \n2                         None                      NaN   \n3                         None                      NaN   \n4                         None                      NaN   \n\n  lateral_rusher_player_id lateral_rusher_player_name  lateral_rushing_yards  \\\n0                     None                       None                    NaN   \n1                     None                       None                    NaN   \n2                     None                       None                    NaN   \n3                     None                       None                    NaN   \n4                     None                       None                    NaN   \n\n  lateral_sack_player_id lateral_sack_player_name interception_player_id  \\\n0                   None                     None                   None   \n1                   None                     None                   None   \n2                   None                     None                   None   \n3                   None                     None                   None   \n4                   None                     None                   None   \n\n  interception_player_name lateral_interception_player_id  \\\n0                     None                           None   \n1                     None                           None   \n2                     None                           None   \n3                     None                           None   \n4                     None                           None   \n\n  lateral_interception_player_name punt_returner_player_id  \\\n0                             None                    None   \n1                             None                    None   \n2                             None                    None   \n3                             None                    None   \n4                             None                    None   \n\n  punt_returner_player_name lateral_punt_returner_player_id  \\\n0                      None                            None   \n1                      None                            None   \n2                      None                            None   \n3                      None                            None   \n4                      None                            None   \n\n  lateral_punt_returner_player_name kickoff_returner_player_name  \\\n0                              None                         None   \n1                              None                         None   \n2                              None                         None   \n3                              None                         None   \n4                              None                         None   \n\n  kickoff_returner_player_id lateral_kickoff_returner_player_id  \\\n0                       None                               None   \n1                       None                               None   \n2                       None                               None   \n3                       None                               None   \n4                       None                               None   \n\n  lateral_kickoff_returner_player_name punter_player_id punter_player_name  \\\n0                                 None             None               None   \n1                                 None             None               None   \n2                                 None             None               None   \n3                                 None             None               None   \n4                                 None             None               None   \n\n  kicker_player_name kicker_player_id own_kickoff_recovery_player_id  \\\n0               None             None                           None   \n1             T.Bass       00-0036162                           None   \n2               None             None                           None   \n3               None             None                           None   \n4               None             None                           None   \n\n  own_kickoff_recovery_player_name blocked_player_id blocked_player_name  \\\n0                             None              None                None   \n1                             None              None                None   \n2                             None              None                None   \n3                             None              None                None   \n4                             None              None                None   \n\n  tackle_for_loss_1_player_id tackle_for_loss_1_player_name  \\\n0                        None                          None   \n1                        None                          None   \n2                        None                          None   \n3                        None                          None   \n4                        None                          None   \n\n  tackle_for_loss_2_player_id tackle_for_loss_2_player_name  \\\n0                        None                          None   \n1                        None                          None   \n2                        None                          None   \n3                        None                          None   \n4                        None                          None   \n\n  qb_hit_1_player_id qb_hit_1_player_name qb_hit_2_player_id  \\\n0               None                 None               None   \n1               None                 None               None   \n2               None                 None               None   \n3               None                 None               None   \n4               None                 None               None   \n\n  qb_hit_2_player_name forced_fumble_player_1_team  \\\n0                 None                        None   \n1                 None                        None   \n2                 None                        None   \n3                 None                        None   \n4                 None                        None   \n\n  forced_fumble_player_1_player_id forced_fumble_player_1_player_name  \\\n0                             None                               None   \n1                             None                               None   \n2                             None                               None   \n3                             None                               None   \n4                             None                               None   \n\n  forced_fumble_player_2_team forced_fumble_player_2_player_id  \\\n0                        None                             None   \n1                        None                             None   \n2                        None                             None   \n3                        None                             None   \n4                        None                             None   \n\n  forced_fumble_player_2_player_name solo_tackle_1_team solo_tackle_2_team  \\\n0                               None               None               None   \n1                               None               None               None   \n2                               None               None               None   \n3                               None               None               None   \n4                               None               None               None   \n\n  solo_tackle_1_player_id solo_tackle_2_player_id solo_tackle_1_player_name  \\\n0                    None                    None                      None   \n1                    None                    None                      None   \n2                    None                    None                      None   \n3                    None                    None                      None   \n4                    None                    None                      None   \n\n  solo_tackle_2_player_name assist_tackle_1_player_id  \\\n0                      None                      None   \n1                      None                      None   \n2                      None                00-0034376   \n3                      None                00-0033551   \n4                      None                00-0035663   \n\n  assist_tackle_1_player_name assist_tackle_1_team assist_tackle_2_player_id  \\\n0                        None                 None                      None   \n1                        None                 None                      None   \n2                  Ta.Johnson                  BUF                      None   \n3                   R.Douglas                  BUF                      None   \n4                      T.Rapp                  BUF                00-0038557   \n\n  assist_tackle_2_player_name assist_tackle_2_team assist_tackle_3_player_id  \\\n0                        None                 None                      None   \n1                        None                 None                      None   \n2                        None                 None                      None   \n3                        None                 None                      None   \n4                 Do.Williams                  BUF                      None   \n\n  assist_tackle_3_player_name assist_tackle_3_team assist_tackle_4_player_id  \\\n0                        None                 None                      None   \n1                        None                 None                      None   \n2                        None                 None                      None   \n3                        None                 None                      None   \n4                        None                 None                      None   \n\n  assist_tackle_4_player_name assist_tackle_4_team  tackle_with_assist  \\\n0                        None                 None                 NaN   \n1                        None                 None                 0.0   \n2                        None                 None                 1.0   \n3                        None                 None                 1.0   \n4                        None                 None                 0.0   \n\n  tackle_with_assist_1_player_id tackle_with_assist_1_player_name  \\\n0                           None                             None   \n1                           None                             None   \n2                     00-0037254                        T.Bernard   \n3                     00-0036888                         D.Hamlin   \n4                           None                             None   \n\n  tackle_with_assist_1_team tackle_with_assist_2_player_id  \\\n0                      None                           None   \n1                      None                           None   \n2                       BUF                           None   \n3                       BUF                           None   \n4                      None                           None   \n\n  tackle_with_assist_2_player_name tackle_with_assist_2_team  \\\n0                             None                      None   \n1                             None                      None   \n2                             None                      None   \n3                             None                      None   \n4                             None                      None   \n\n  pass_defense_1_player_id pass_defense_1_player_name  \\\n0                     None                       None   \n1                     None                       None   \n2                     None                       None   \n3                     None                       None   \n4                     None                       None   \n\n  pass_defense_2_player_id pass_defense_2_player_name fumbled_1_team  \\\n0                     None                       None           None   \n1                     None                       None           None   \n2                     None                       None           None   \n3                     None                       None           None   \n4                     None                       None           None   \n\n  fumbled_1_player_id fumbled_1_player_name fumbled_2_player_id  \\\n0                None                  None                None   \n1                None                  None                None   \n2                None                  None                None   \n3                None                  None                None   \n4                None                  None                None   \n\n  fumbled_2_player_name fumbled_2_team fumble_recovery_1_team  \\\n0                  None           None                   None   \n1                  None           None                   None   \n2                  None           None                   None   \n3                  None           None                   None   \n4                  None           None                   None   \n\n   fumble_recovery_1_yards fumble_recovery_1_player_id  \\\n0                      NaN                        None   \n1                      NaN                        None   \n2                      NaN                        None   \n3                      NaN                        None   \n4                      NaN                        None   \n\n  fumble_recovery_1_player_name fumble_recovery_2_team  \\\n0                          None                   None   \n1                          None                   None   \n2                          None                   None   \n3                          None                   None   \n4                          None                   None   \n\n   fumble_recovery_2_yards fumble_recovery_2_player_id  \\\n0                      NaN                        None   \n1                      NaN                        None   \n2                      NaN                        None   \n3                      NaN                        None   \n4                      NaN                        None   \n\n  fumble_recovery_2_player_name sack_player_id sack_player_name  \\\n0                          None           None             None   \n1                          None           None             None   \n2                          None           None             None   \n3                          None           None             None   \n4                          None           None             None   \n\n  half_sack_1_player_id half_sack_1_player_name half_sack_2_player_id  \\\n0                  None                    None                  None   \n1                  None                    None                  None   \n2                  None                    None                  None   \n3                  None                    None                  None   \n4                  None                    None                  None   \n\n  half_sack_2_player_name return_team  return_yards penalty_team  \\\n0                    None        None           NaN         None   \n1                    None         ARI           0.0         None   \n2                    None        None           0.0         None   \n3                    None        None           0.0         None   \n4                    None        None           0.0         None   \n\n  penalty_player_id penalty_player_name  penalty_yards  replay_or_challenge  \\\n0              None                None            NaN                  0.0   \n1              None                None            NaN                  0.0   \n2              None                None            NaN                  0.0   \n3              None                None            NaN                  0.0   \n4              None                None            NaN                  0.0   \n\n  replay_or_challenge_result penalty_type  defensive_two_point_attempt  \\\n0                       None         None                          NaN   \n1                       None         None                          0.0   \n2                       None         None                          0.0   \n3                       None         None                          0.0   \n4                       None         None                          0.0   \n\n   defensive_two_point_conv  defensive_extra_point_attempt  \\\n0                       NaN                            NaN   \n1                       0.0                            0.0   \n2                       0.0                            0.0   \n3                       0.0                            0.0   \n4                       0.0                            0.0   \n\n   defensive_extra_point_conv safety_player_name safety_player_id  season  \\\n0                         NaN               None             None    2024   \n1                         0.0               None             None    2024   \n2                         0.0               None             None    2024   \n3                         0.0               None             None    2024   \n4                         0.0               None             None    2024   \n\n         cp       cpoe  series  series_success series_result  order_sequence  \\\n0       NaN        NaN     1.0             1.0    First down             1.0   \n1       NaN        NaN     1.0             1.0    First down            40.0   \n2       NaN        NaN     1.0             1.0    First down            61.0   \n3  0.868591  13.140899     1.0             1.0    First down            83.0   \n4  0.807773  19.222683     2.0             1.0    First down           108.0   \n\n         start_time               time_of_day           stadium  \\\n0  9/8/24, 13:03:02                      None  Highmark Stadium   \n1  9/8/24, 13:03:02  2024-09-08T17:03:02.957Z  Highmark Stadium   \n2  9/8/24, 13:03:02  2024-09-08T17:03:40.463Z  Highmark Stadium   \n3  9/8/24, 13:03:02  2024-09-08T17:04:12.743Z  Highmark Stadium   \n4  9/8/24, 13:03:02  2024-09-08T17:04:57.067Z  Highmark Stadium   \n\n                                             weather  \\\n0  Clouds and sun with wind Temp: 61\u00b0 F, Humidity...   \n1  Clouds and sun with wind Temp: 61\u00b0 F, Humidity...   \n2  Clouds and sun with wind Temp: 61\u00b0 F, Humidity...   \n3  Clouds and sun with wind Temp: 61\u00b0 F, Humidity...   \n4  Clouds and sun with wind Temp: 61\u00b0 F, Humidity...   \n\n                             nfl_api_id play_clock  play_deleted  \\\n0  7d40236a-1312-11ef-afd1-646009f18b2e          0           0.0   \n1  7d40236a-1312-11ef-afd1-646009f18b2e          0           0.0   \n2  7d40236a-1312-11ef-afd1-646009f18b2e          0           0.0   \n3  7d40236a-1312-11ef-afd1-646009f18b2e          0           0.0   \n4  7d40236a-1312-11ef-afd1-646009f18b2e          0           0.0   \n\n  play_type_nfl  special_teams_play st_play_type            end_clock_time  \\\n0    GAME_START                 0.0         None                      None   \n1      KICK_OFF                 1.0         None  2024-09-08T17:03:06.833Z   \n2          RUSH                 0.0         None  2024-09-08T17:03:43.660Z   \n3          PASS                 0.0         None  2024-09-08T17:04:20.843Z   \n4          PASS                 0.0         None  2024-09-08T17:05:03.770Z   \n\n  end_yard_line  fixed_drive fixed_drive_result     drive_real_start_time  \\\n0          None          1.0          Touchdown                      None   \n1          None          1.0          Touchdown  2024-09-08T17:03:02.957Z   \n2          None          1.0          Touchdown  2024-09-08T17:03:02.957Z   \n3          None          1.0          Touchdown  2024-09-08T17:03:02.957Z   \n4          None          1.0          Touchdown  2024-09-08T17:03:02.957Z   \n\n   drive_play_count drive_time_of_possession  drive_first_downs  \\\n0               NaN                     None                NaN   \n1              13.0                     7:13                5.0   \n2              13.0                     7:13                5.0   \n3              13.0                     7:13                5.0   \n4              13.0                     7:13                5.0   \n\n   drive_inside20  drive_ended_with_score  drive_quarter_start  \\\n0             NaN                     NaN                  NaN   \n1             1.0                     1.0                  1.0   \n2             1.0                     1.0                  1.0   \n3             1.0                     1.0                  1.0   \n4             1.0                     1.0                  1.0   \n\n   drive_quarter_end  drive_yards_penalized drive_start_transition  \\\n0                NaN                    NaN                   None   \n1                1.0                   10.0                KICKOFF   \n2                1.0                   10.0                KICKOFF   \n3                1.0                   10.0                KICKOFF   \n4                1.0                   10.0                KICKOFF   \n\n  drive_end_transition drive_game_clock_start drive_game_clock_end  \\\n0                 None                   None                 None   \n1            TOUCHDOWN                  15:00                07:47   \n2            TOUCHDOWN                  15:00                07:47   \n3            TOUCHDOWN                  15:00                07:47   \n4            TOUCHDOWN                  15:00                07:47   \n\n  drive_start_yard_line drive_end_yard_line  drive_play_id_started  \\\n0                  None                None                    NaN   \n1                ARI 30               BUF 5                   40.0   \n2                ARI 30               BUF 5                   40.0   \n3                ARI 30               BUF 5                   40.0   \n4                ARI 30               BUF 5                   40.0   \n\n   drive_play_id_ended  away_score  home_score location  result  total  \\\n0                  NaN          28          34     Home       6     62   \n1                407.0          28          34     Home       6     62   \n2                407.0          28          34     Home       6     62   \n3                407.0          28          34     Home       6     62   \n4                407.0          28          34     Home       6     62   \n\n   spread_line  total_line  div_game      roof surface  temp  wind  \\\n0          6.5        46.0         0  outdoors  a_turf  61.0  20.0   \n1          6.5        46.0         0  outdoors  a_turf  61.0  20.0   \n2          6.5        46.0         0  outdoors  a_turf  61.0  20.0   \n3          6.5        46.0         0  outdoors  a_turf  61.0  20.0   \n4          6.5        46.0         0  outdoors  a_turf  61.0  20.0   \n\n       home_coach       away_coach stadium_id   game_stadium  aborted_play  \\\n0  Sean McDermott  Jonathan Gannon      BUF00  New Era Field           0.0   \n1  Sean McDermott  Jonathan Gannon      BUF00  New Era Field           0.0   \n2  Sean McDermott  Jonathan Gannon      BUF00  New Era Field           0.0   \n3  Sean McDermott  Jonathan Gannon      BUF00  New Era Field           0.0   \n4  Sean McDermott  Jonathan Gannon      BUF00  New Era Field           0.0   \n\n   success    passer  passer_jersey_number    rusher  rusher_jersey_number  \\\n0      0.0      None                   NaN      None                   NaN   \n1      1.0      None                   NaN      None                   NaN   \n2      0.0      None                   NaN  J.Conner                   6.0   \n3      1.0  K.Murray                   1.0      None                   NaN   \n4      1.0  K.Murray                   1.0      None                   NaN   \n\n   receiver  receiver_jersey_number  pass  rush  first_down  special  play  \\\n0      None                     NaN   0.0   0.0         NaN      0.0   0.0   \n1      None                     NaN   0.0   0.0         0.0      1.0   0.0   \n2      None                     NaN   0.0   1.0         0.0      0.0   1.0   \n3  J.Conner                     6.0   1.0   0.0         1.0      0.0   1.0   \n4  J.Conner                     6.0   1.0   0.0         0.0      0.0   1.0   \n\n    passer_id   rusher_id receiver_id      name  jersey_number          id  \\\n0        None        None        None      None            NaN        None   \n1        None        None        None      None            NaN        None   \n2        None  00-0033553        None  J.Conner            6.0  00-0033553   \n3  00-0035228        None  00-0033553  K.Murray            1.0  00-0035228   \n4  00-0035228        None  00-0033553  K.Murray            1.0  00-0035228   \n\n  fantasy_player_name fantasy_player_id   fantasy  fantasy_id  out_of_bounds  \\\n0                None              None      None        None            0.0   \n1                None              None      None        None            0.0   \n2            J.Conner        00-0033553  J.Conner  00-0033553            0.0   \n3            J.Conner        00-0033553  J.Conner  00-0033553            0.0   \n4            J.Conner        00-0033553  J.Conner  00-0033553            0.0   \n\n   home_opening_kickoff    qb_epa  xyac_epa  xyac_mean_yardage  \\\n0                   0.0 -0.000000       NaN                NaN   \n1                   0.0  0.257819       NaN                NaN   \n2                   0.0 -0.200602       NaN                NaN   \n3                   0.0  2.028874  1.345418           9.321221   \n4                   0.0  0.754242  0.882798           5.783560   \n\n   xyac_median_yardage  xyac_success   xyac_fd     xpass    pass_oe  \n0                  NaN           NaN       NaN       NaN        NaN  \n1                  NaN           NaN       NaN       NaN        NaN  \n2                  NaN           NaN       NaN  0.456761 -45.676102  \n3                  8.0      0.509778  0.363807  0.576656  42.334431  \n4                  4.0      0.668478  0.255140  0.426443  57.355690  "
        },
        {
          "type": "code",
          "language": "python",
          "content": "play_by_play.head(20).to_csv(\"pbp_first20.csv\", index=False)"
        },
        {
          "type": "code",
          "language": "python",
          "content": "# let's drop few columns which won't contribute to the model using ball knowledge (TODO)\n# churn_data.drop(['CustomerId','Surname'],axis=1,inplace=True)"
        },
        {
          "type": "code",
          "language": "python",
          "content": "play_by_play[\"play_type\"].value_counts(dropna=False)"
        },
        {
          "type": "stdout",
          "content": "pass           20006\nrun            15044\nno_play         4934\nkickoff         2949\npunt            2119\nNone            1460\nextra_point     1302\nfield_goal      1166\nqb_kneel         437\nqb_spike          75\nName: play_type, dtype: int64"
        },
        {
          "type": "code",
          "language": "python",
          "content": "# normalize the play_type string (safe for NaN)\nplay_by_play['play_type_norm'] = play_by_play['play_type'].astype(str).str.strip().str.lower()\n\n# strict mapping: only exact 'pass' and 'run' become those classes; everything else -> 'other'\ndef simple_map(x):\n    if x == 'pass':\n        return 'pass'\n    if x == 'run':\n        return 'run'\n    return 'other'\n\nplay_by_play['play_type_simple'] = play_by_play['play_type_norm'].apply(simple_map).astype('category')\n\n# print counts\nprint(\"Counts:\")\nprint(play_by_play['play_type_simple'].value_counts(dropna=False))\n\n# drop intermediate column play_type_norm\nplay_by_play.drop(['play_type_norm'],axis=1,inplace=True)"
        },
        {
          "type": "stdout",
          "content": "Counts:\npass     20006\nrun      15044\nother    14442\nName: play_type_simple, dtype: int64\n"
        },
        {
          "type": "code",
          "language": "python",
          "content": "# add next play type by first sorting and grouping\nplay_by_play[\"down_sort\"] = play_by_play[\"down\"].fillna(0)  # NaN downs (kickoffs/returns) become 0\nplay_by_play_sorted = play_by_play.sort_values(\n    by=[\"game_id\", \"game_seconds_remaining\", \"down_sort\", \"play_id\"],\n    ascending=[True, False, True, True]\n).drop(columns=\"down_sort\")\n\n# then grouping\nplay_by_play_sorted[\"next_play_type\"] = (\n    play_by_play_sorted.groupby(\"game_id\")[\"play_type_simple\"]\n      .shift(-1)   # shift backwards \u2192 next row\u2019s play_type\n)\n\nplay_by_play_sorted[\"next_play_type\"]"
        },
        {
          "type": "stdout",
          "content": "0        other\n1          run\n2         pass\n3         pass\n4          run\n         ...  \n49487    other\n49488    other\n49489    other\n49490    other\n49491      NaN\nName: next_play_type, Length: 49492, dtype: category\nCategories (3, object): ['other', 'pass', 'run']"
        },
        {
          "type": "code",
          "language": "python",
          "content": "# Keep only rows where NEXT play is run or pass; build binary label (pass=1, rush=0)\nplay_by_play_sorted = play_by_play_sorted[play_by_play_sorted[\"next_play_type\"].isin([\"pass\", \"run\"])].copy()\ny = (play_by_play_sorted[\"next_play_type\"] == \"pass\").astype(int)\n\n# Drop target column\ndrop_cols = [\n    \"next_play_type\"\n]\nX = play_by_play_sorted.drop(columns=[c for c in drop_cols if c in play_by_play_sorted.columns])"
        },
        {
          "type": "code",
          "language": "python",
          "content": "# Split by game\ngroups = play_by_play_sorted[\"game_id\"] if \"game_id\" in play_by_play_sorted.columns else pd.Series(np.arange(len(play_by_play_sorted)))\ngss = GroupShuffleSplit(n_splits=1, test_size=0.2, random_state=42)\n# We\u2019ll encode after splitting to avoid leakage from encoders (fit on train only)\ntrain_idx, test_idx = next(gss.split(X, y, groups=groups))"
        },
        {
          "type": "code",
          "language": "python",
          "content": "# Splitting the dataset into the Training set and Test set\nX_train_raw, X_test_raw = X.iloc[train_idx].copy(), X.iloc[test_idx].copy()\ny_train, y_test = y.iloc[train_idx], y.iloc[test_idx]"
        },
        {
          "type": "code",
          "language": "python",
          "content": "# Categorical handling for LightGBM\nobj_cols = X_train_raw.select_dtypes(include=[\"object\"]).columns\nfor c in obj_cols:\n    X_train_raw[c] = X_train_raw[c].astype(\"category\")\n    X_test_raw[c]  = X_test_raw[c].astype(\"category\")\n\n# Keep track of categorical column names (LightGBM sklearn wrapper accepts names)\ncategorical_cols = list(X_train_raw.select_dtypes(include=[\"category\"]).columns)"
        },
        {
          "type": "code",
          "language": "python",
          "content": "# Train LightGBM with early stopping\nclf = LGBMClassifier(\n    n_estimators=2000,\n    learning_rate=0.05,\n    num_leaves=31,\n    random_state=42,\n    n_jobs=-1\n)\n\nclf.fit(\n    X_train_raw, y_train,\n    eval_set=[(X_test_raw, y_test)],\n    eval_metric=\"logloss\",\n    categorical_feature=categorical_cols,\n    callbacks=[early_stopping(100), log_evaluation(50)]   # replaces early_stopping_rounds & verbose\n)"
        },
        {
          "type": "stdout",
          "content": "[LightGBM] [Warning] Categorical features with more bins than the configured maximum bin number found.\n[LightGBM] [Warning] For categorical features, max_bin and max_bin_by_feature may be ignored with a large number of categories.\n[LightGBM] [Info] Number of positive: 15945, number of negative: 12084\n[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 0.019368 seconds.\nYou can set `force_col_wise=true` to remove the overhead.\n[LightGBM] [Info] Total Bins 45505\n[LightGBM] [Info] Number of data points in the train set: 28029, number of used features: 338\n"
        },
        {
          "type": "stdout",
          "content": "[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.568875 -> initscore=0.277263\n[LightGBM] [Info] Start training from score 0.277263\nTraining until validation scores don't improve for 100 rounds\n"
        },
        {
          "type": "stdout",
          "content": "[50]\tvalid_0's binary_logloss: 0.613558\n"
        },
        {
          "type": "stdout",
          "content": "[100]\tvalid_0's binary_logloss: 0.63149\n"
        },
        {
          "type": "stdout",
          "content": "Early stopping, best iteration is:\n[41]\tvalid_0's binary_logloss: 0.610887\n"
        },
        {
          "type": "stdout",
          "content": "LGBMClassifier(learning_rate=0.05, n_estimators=2000, n_jobs=-1,\n               random_state=42)"
        },
        {
          "type": "code",
          "language": "python",
          "content": "y_pred = clf.predict(X_test_raw)\nprint(\"Accuracy:\", accuracy_score(y_test, y_pred))\nprint(\"F1:\", f1_score(y_test, y_pred))\nprint(\"Confusion matrix:\\n\", confusion_matrix(y_test, y_pred))\nprint(classification_report(y_test, y_pred, target_names=[\"rush\",\"pass\"]))"
        },
        {
          "type": "stdout",
          "content": "Accuracy:"
        },
        {
          "type": "stdout",
          "content": " 0.6590229312063809\nF1: 0.7093954843408594\nConfusion matrix:\n [[1705 1255]\n [1139 2922]]\n              precision    recall  f1-score   support\n\n        rush       0.60      0.58      0.59      2960\n        pass       0.70      0.72      0.71      4061\n\n    accuracy                           0.66      7021\n   macro avg       0.65      0.65      0.65      7021\nweighted avg       0.66      0.66      0.66      7021\n\n"
        },
        {
          "type": "code",
          "language": "python",
          "content": "ConfusionMatrixDisplay.from_predictions(\n    y_test, y_pred, display_labels=[\"Rush\",\"Pass\"], cmap=\"Blues\"\n)\nplt.title(\"Confusion Matrix\")\nplt.show()"
        },
        {
          "type": "image",
          "src": "/images/1.0/cell_17_img_01.png",
          "alt": "cell_17_img_01.png"
        },
        {
          "type": "stdout",
          "content": "<Figure size 640x480 with 2 Axes>"
        },
        {
          "type": "code",
          "language": "python",
          "content": "RocCurveDisplay.from_estimator(clf, X_test_raw, y_test, name=\"LightGBM\")\nplt.title(\"ROC Curve\")\nplt.show()"
        },
        {
          "type": "image",
          "src": "/images/1.0/cell_18_img_02.png",
          "alt": "cell_18_img_02.png"
        },
        {
          "type": "stdout",
          "content": "<Figure size 640x480 with 1 Axes>"
        },
        {
          "type": "code",
          "language": "python",
          "content": "lgb.plot_importance(clf, max_num_features=20, importance_type=\"gain\")\nplt.title(\"Top 20 Feature Importances\")\nplt.show()"
        },
        {
          "type": "image",
          "src": "/images/1.0/cell_19_img_03.png",
          "alt": "cell_19_img_03.png"
        },
        {
          "type": "stdout",
          "content": "<Figure size 640x480 with 1 Axes>"
        },
        {
          "type": "code",
          "language": "python",
          "content": "PrecisionRecallDisplay.from_estimator(clf, X_test_raw, y_test, name=\"LightGBM\")\nplt.title(\"Precision-Recall Curve\")\nplt.show()"
        },
        {
          "type": "image",
          "src": "/images/1.0/cell_20_img_04.png",
          "alt": "cell_20_img_04.png"
        },
        {
          "type": "stdout",
          "content": "<Figure size 640x480 with 1 Axes>"
        }
      ]
    }
  ]
}